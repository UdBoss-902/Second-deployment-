<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UDBOSS WAY — Wellness Habit Tracker</title>
<style>
    :root{
      --bg:#071028; --card:#0b1724; --muted:#9fb0c8; --accent:#6ee7b7; --accent2:#60a5fa;
      --radius:12px; --glass: rgba(255,255,255,0.03);
      --maxw:980px; --ff: Inter, system-ui, Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--ff); background:linear-gradient(180deg,#071028 0%, #021021 100%); color:#e6f0fb; padding:28px; display:flex; justify-content:center;}
    .wrap{width:100%; max-width:var(--maxw)}
    header{display:flex; gap:16px; align-items:center; margin-bottom:18px; flex-wrap:wrap}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:56px; height:56px; border-radius:12px; display:grid; place-items:center; font-weight:800; color:#042028; background:linear-gradient(135deg,var(--accent),var(--accent2))}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    main{display:grid; grid-template-columns:1fr 320px; gap:18px}
    @media(max-width:840px){main{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .controls{display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap}
    input,select,textarea,button{font:inherit}
    .form-input{padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; padding:10px 12px; border-radius:10px; color:#042028; font-weight:700; cursor:pointer}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); font-weight:600}
    .list{display:flex; flex-direction:column; gap:10px}
    .habit{display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background:var(--card); border:1px solid rgba(255,255,255,0.02)}
    .left{flex:1}
    .title{font-weight:700}
    .meta{color:var(--muted); font-size:13px}
    .right{display:flex; flex-direction:column; gap:8px; align-items:flex-end}
    .progress-wrap{width:160px; max-width:40vw}
    .bar{height:10px; background:rgba(255,255,255,0.03); border-radius:999px; overflow:hidden}
    .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width 700ms cubic-bezier(.2,.9,.2,1)}
    .row{display:flex; gap:8px; align-items:center}
    .muted{color:var(--muted); font-size:13px}
    .small{font-size:12px}
    .streak{background:var(--glass); padding:6px 8px; border-radius:8px; font-weight:700; color:var(--muted); font-size:13px}
    .actions{display:flex; gap:8px}
    .confetti{position:fixed; pointer-events:none; inset:0; overflow:hidden; z-index:60}
    .confetti span{position:absolute; width:8px; height:14px; opacity:0; transform:translateY(-20px) rotate(10deg); animation:fall 1200ms linear forwards}
    @keyframes fall{to{transform:translateY(120vh) rotate(360deg); opacity:1}}
    footer{margin-top:18px; color:var(--muted); font-size:13px; text-align:center}
    .export-area{width:100%; height:120px; background:rgba(255,255,255,0.02); border-radius:8px; padding:8px; color:var(--muted); font-family:monospace; font-size:12px; overflow:auto}
    .sr-only{position:absolute; left:-9999px}
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="UDBOSS WAY Habit Tracker">
<header>
<div class="brand">
<div class="logo">UD</div>
<div>
<h1>UDBOSS WAY</h1>
<p class="lead">Wellness Habit Tracker — add habits, keep streaks, build the Empire.</p>
</div>
</div>
<div style="margin-left:auto" class="row">
<button class="btn" id="exportBtn">Export JSON</button>
<button class="btn ghost" id="importBtn">Import</button>
</div>
</header>

<main>
<section>
<div class="card">
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px">
<div><strong>Habits</strong><div class="muted small">Track daily completions and streaks</div></div>
<div class="muted small">Local only; backup with export</div>
</div>

<div class="controls" aria-hidden="false">
<input id="habitName" class="form-input" placeholder="Habit name e.g. Drink water" aria-label="Habit name" />
<input id="habitGoal" type="number" min="1" value="1" class="form-input" style="width:84px" aria-label="Daily goal" />
<button class="btn" id="addBtn">Add Habit</button>
</div>

<div id="list" class="list" aria-live="polite"></div>
</div>

<footer>
<div class="muted small">UDBOSS WAY • Build consistency, brick by brick.</div>
</footer>
</section>

<aside>
<div class="card" style="display:flex; flex-direction:column; gap:12px">
<div><strong>Backup / Restore</strong><div class="muted small">Copy the JSON to move data between devices</div></div>
<textarea id="exportArea" class="export-area" readonly aria-label="Export data JSON"></textarea>
<div style="display:flex; gap:8px">
<button class="btn ghost" id="clearBtn">Clear All</button>
<button class="btn" id="resetDayBtn">Force Daily Reset</button>
</div>
</div>
</aside>
</main>

<div id="confetti" class="confetti" aria-hidden="true"></div>
</div>

<script>
    /* UDBOSS WAY — Single file app */
    const LS_KEY = 'udboss_habits_v1';
    const listEl = document.getElementById('list');
    const exportArea = document.getElementById('exportArea');
    const confettiEl = document.getElementById('confetti');

    let state = { habits: [], lastSeenDate: null };

    function nowDateISO(){ const d=new Date(); d.setHours(0,0,0,0); return d.toISOString(); }

    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(raw){ state = JSON.parse(raw); } else { state = { habits: [], lastSeenDate: nowDateISO() }; save(); }
      }catch(e){ state = { habits: [], lastSeenDate: nowDateISO() }; save(); }
      dailyResetIfNeeded();
      render();
    }

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); exportArea.value = JSON.stringify(state, null, 2); }

    function addHabit(name, goal){
      if(!name || !goal) return;
      state.habits.push({
        id: Date.now().toString(36),
        name: name.trim(),
        goal: Number(goal) || 1,
        history: {}, // dateISO -> count
        streak: 0,
        lastCompletedDate: null
      });
      save(); render();
    }

    function removeHabit(id){
      state.habits = state.habits.filter(h=>h.id!==id); save(); render();
    }

    function markComplete(id){
      const h = state.habits.find(x=>x.id===id);
      if(!h) return;
      const today = nowDateISO();
      const currentCount = h.history[today] || 0;
      if(currentCount >= h.goal) return;
      h.history[today] = currentCount + 1;
      if(h.history[today] === h.goal){
        updateStreak(h, today);
      }
      h.lastCompletedDate = today;
      save(); render();
    }

    function updateStreak(habit, todayISO){
      // increment streak if yesterday was completed, else reset to 1
      const y = new Date(todayISO); y.setDate(y.getDate()-1); const yISO = y.toISOString();
      const yesterdayDone = (habit.history[yISO] || 0) >= habit.goal;
      habit.streak = yesterdayDone ? (habit.streak || 0) + 1 : 1;
      // milestone confetti
      if([3,7,30].includes(habit.streak)) playConfetti();
    }

    function dailyResetIfNeeded(){
      const last = state.lastSeenDate || nowDateISO();
      const today = nowDateISO();
      if(last !== today){
        // preserve history and streaks; just update lastSeenDate so new day starts fresh
        state.lastSeenDate = today;
        save();
      }
    }

    function forceDailyReset(){
      state.lastSeenDate = nowDateISO();
      save();
      render();
    }

    function progressPercent(h){
      const today = nowDateISO();
      const count = h.history[today] || 0;
      return Math.min(100, Math.round((count / h.goal) * 100));
    }

    function render(){
      listEl.innerHTML = '';
      state.habits.forEach(h=>{
        const percent = progressPercent(h);
        const item = document.createElement('div');
        item.className = 'habit';
        item.innerHTML = `
<div class="left">
<div class="title">${escapeHtml(h.name)}</div>
<div class="meta">${(h.history[nowDateISO()]||0)} / ${h.goal} today • <span class="streak">${h.streak}d streak</span></div>
</div>
<div class="right">
<div class="progress-wrap" aria-hidden="false">
<div class="bar"><i style="width:${percent}%"></i></div>
</div>
<div class="row">
<button class="btn" data-action="mark" data-id="${h.id}" ${percent===100? 'disabled':''}>${percent===100? 'Done':'+ Complete'}</button>
<button class="btn ghost" data-action="remove" data-id="${h.id}">Delete</button>
</div>
</div>
        `;
        listEl.appendChild(item);
      });
      save();
    }

    // helpers
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]) ); }

    // confetti
    function playConfetti(){
      confettiEl.innerHTML = '';
      const colors = ['#6ee7b7','#60a5fa','#fca5a5','#fdd86a','#c4b5fd'];
      for(let i=0;i<30;i++){
        const el = document.createElement('span');
        el.style.left = Math.random()*100 + '%';
        el.style.background = colors[Math.floor(Math.random()*colors.length)];
        el.style.top = (Math.random()*20 - 10) + '%';
        el.style.transform = `rotate(${Math.random()*360}deg)`;
        el.style.animationDelay = (Math.random()*300) + 'ms';
        confettiEl.appendChild(el);
      }
      setTimeout(()=> confettiEl.innerHTML = '', 1400);
    }

    // export/import/clear
    document.getElementById('exportBtn').addEventListener('click', ()=> {
      exportArea.select();
      try{ document.execCommand('copy'); }catch(e){}
    });

    document.getElementById('importBtn').addEventListener('click', ()=> {
      const data = prompt('Paste exported JSON here to import. This will replace your local data.');
      if(!data) return;
      try{
        const parsed = JSON.parse(data);
        if(parsed && parsed.habits){
          state = parsed;
          save(); render();
          alert('Import successful');
        }else alert('Imported JSON is not valid.');
      }catch(e){ alert('Invalid JSON.') }
    });

    document.getElementById('clearBtn').addEventListener('click', ()=> {
      if(confirm('Clear all habits and data?')){ state = { habits: [], lastSeenDate: nowDateISO() }; save(); render(); }
    });

    document.getElementById('resetDayBtn').addEventListener('click', ()=> {
      if(confirm('Force a daily reset now?')){ forceDailyReset(); alert('Day reset forced.'); }
    });

    document.getElementById('addBtn').addEventListener('click', ()=> {
      const name = document.getElementById('habitName').value;
      const goal = document.getElementById('habitGoal').value || 1;
      if(!name.trim()){ alert('Enter a habit name.'); return; }
      addHabit(name, goal);
      document.getElementById('habitName').value = '';
      document.getElementById('habitGoal').value = 1;
    });

    listEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      if(action === 'mark') markComplete(id);
      if(action === 'remove'&& confirm('Delete this habit?')) removeHabit(id);
    });

    // daily reset runner: check when page becomes visible or on load
    document.addEventListener('visibilitychange', ()=> { if(document.visibilityState === 'visible') dailyResetIfNeeded(); render(); });
    window.addEventListener('focus', ()=> { dailyResetIfNeeded(); render(); });

    // keyboard shortcut: Ctrl/Cmd+K to focus add input
    document.addEventListener('keydown', (e)=> { if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); document.getElementById('habitName').focus(); } });

    // init
    load();
</script>
</body>
</html>
